<!DOCTYPE html>
<html>
    <head>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üì∫</text></svg>">

<meta charset="utf-8">
<meta name="viewport" content="width=device-width,height=device-height,initial-scale=1.0"/>
<meta name="description" content="A YouTube aggregator that serves only videos without edits to the filename.">

<meta property="og:title" content="default filename tv">
<meta property="og:description" content="A YouTube aggregator that serves only videos without edits to the filename.">
<meta property="og:url" content="defaultfile.name/">
<meta name="twitter:card" content="summary">

    <title>default filename tv</title>


<style>
#player{
  min-width:100px;
  width: 70vw;
  height: 40vw;
  }
</style>


<body bgcolor="black">
<center>
    <font face="courier" color="white" size="2">
    <br>
    <i> default filename tv </i><br><br>

    <div id="player"></div><br><br>
    <!-- <div id="videoInfo">loading...</div><br> -->
    <div id="projectInfo"><i>default filename tv </i> finds and plays youtube videos that were uploaded from the camera without edits to the filename.</div><br>
    <div id="error-text"></div><br>
<button type="button" onClick="lastVideo()">‚Üê previous video</button> 
<button type="button" onClick="nextVideo()">next video ‚Üí</button> 
</center>
</body>
</html>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
    let player;
    let videoHistory = [];
    let currentVideoIndex = -1;
    let playbackErrorCount = 0;

    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            height: '360',
            width: '640',
            videoId: '',
            playerVars: {
                'rel': 0,
                'showinfo': 0
            },
            events: {
                'onReady': onPlayerReady,
                'onError': onPlayerError
            }
        });
        // Load video history from local storage
        videoHistory = JSON.parse(localStorage.getItem('videoHistory')) || [];
        currentVideoIndex = videoHistory.length - 1;
        if (currentVideoIndex >= 0) {
            player.loadVideoById(videoHistory[currentVideoIndex]);
        }
    }

    function onPlayerReady(event) {
        newVideo();
        updateButtons();
    }

    function onPlayerError(event) {
        if (playbackErrorCount < 2) {
            playbackErrorCount++;
            newVideo();
        } else {
            console.error('Error:', event.data);
        }
    }

    function newVideo() {
        let attempts = 0;
        const maxAttempts = 4;
        const fetchVideo = async () => {
            attempts++;
            try {
                const response = await fetch('/random');
                if (!response.ok) {
                    throw new Error(await response.text());
                }
                const data = await response.json();
                document.getElementById('error-text').innerHTML = '';
                if (currentVideoIndex < videoHistory.length - 1) {
                    videoHistory = videoHistory.slice(0, currentVideoIndex + 1);
                }
                videoHistory.push(data.videoId);
                currentVideoIndex = videoHistory.length - 1;
                player.loadVideoById(data.videoId);
                // Save video history to local storage
                localStorage.setItem('videoHistory', JSON.stringify(videoHistory));
                updateButtons();
            } catch (error) {
                console.error('Error:', error);
                if (attempts < maxAttempts) {
                    fetchVideo();
                } else {
                    document.getElementById('error-text').innerHTML = 'Error: ' + error.message;
                    document.getElementById('error-text').style.color = 'red';
                }
            }
        };
        fetchVideo();
    }

    function lastVideo() {
        if (currentVideoIndex > 0) {
            currentVideoIndex--;
            player.loadVideoById(videoHistory[currentVideoIndex]);
            updateButtons();
        }
    }

    function nextVideo() {
        if (currentVideoIndex < videoHistory.length - 1) {
            currentVideoIndex++;
            player.loadVideoById(videoHistory[currentVideoIndex]);
        } else {
            newVideo();
        }
        updateButtons();
    }

    function updateButtons() {
        const previousButton = document.querySelector('button[onClick="lastVideo()"]');
        const nextButton = document.querySelector('button[onClick="nextVideo()"]');
        if (previousButton) {
            previousButton.disabled = currentVideoIndex <= 0;
        }
        if (nextButton) {
            nextButton.disabled = false;
        }
    }
</script>
